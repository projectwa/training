# Lesson 9: Advanced Customization (Tailwind CSS)

Welcome to **Advanced Customization**. In this lesson, you'll learn how to tailor Tailwind to your productâ€™s design system: extending the theme, adding utilities, creating plugins, dark-mode and theming strategies, and production-hardening your build.

> **Prerequisites:** You should already be comfortable with the Tailwind CLI/build flow from earlier lessons.

---

## 1) The Tailwind Config (`tailwind.config.js`)

Create a config if you donâ€™t have one yet:

```bash
npx tailwindcss init -p
```
This generates:
- `tailwind.config.js` â€“ your design tokens, variants, plugins, etc.
- `postcss.config.js` â€“ (if `-p` used) PostCSS pipeline (helpful, but optional for CLI).

**Basic shape:**
```js
// tailwind.config.js
/** @type {import('tailwindcss').Config} */
module.exports = {
  content: ["./public/**/*.html", "./src/**/*.{js,ts,jsx,tsx}"],
  theme: {
    extend: {},
  },
  plugins: [],
};
```

---

## 2) Extending Theme Tokens

Use `theme.extend` to _add to_ Tailwindâ€™s defaults without replacing them.

```js
// tailwind.config.js
module.exports = {
  content: ["./public/**/*.html", "./src/**/*.{js,ts,jsx,tsx}"],
  theme: {
    extend: {
      colors: {
        brand: {
          50:  "#f5f8ff",
          100: "#e8efff",
          200: "#cad9ff",
          300: "#9eb8ff",
          400: "#6b8eff",
          500: "#3c66ff",  // primary
          600: "#284be0",
          700: "#1f3ab3",
          800: "#192f8a",
          900: "#162a73",
        },
      },
      fontFamily: {
        display: ['"Inter var"', "Inter", "ui-sans-serif", "system-ui"],
      },
      spacing: {
        18: "4.5rem",
        128: "32rem",
      },
      borderRadius: {
        "2xl": "1rem",
        "3xl": "1.5rem",
      },
    },
  },
};
```

**Usage examples:**
```html
<button class="bg-brand-500 hover:bg-brand-600 text-white px-4 py-2 rounded-2xl">
  Primary Button
</button>

<h1 class="font-display text-3xl md:text-5xl">Marketing Headline</h1>
<div class="p-18">Custom spacing</div>
```

---

## 3) Replacing Defaults vs Extending

If you need to **replace** Tailwindâ€™s defaults, set keys at `theme.*` instead of `theme.extend.*`:

```js
// Completely replace the default spacing scale (be cautious)
theme: {
  spacing: {
    xs: "0.25rem",
    sm: "0.5rem",
    md: "1rem",
    lg: "1.5rem",
    xl: "2rem",
  },
}
```

> Prefer `extend` unless you truly want to own the full scale.

---

## 4) @layer, @apply, and Custom Utilities

Inside your source CSS (e.g., `src/input.css`), you can author utilities/components using Tailwind layers.

```css
@tailwind base;
@tailwind components;
@tailwind utilities;

/* Reusable component class */
@layer components {
  .btn {
    @apply inline-flex items-center gap-2 rounded-lg px-4 py-2 font-medium transition
           bg-brand-500 text-white hover:bg-brand-600 focus:outline-none focus:ring-2 focus:ring-brand-300;
  }
}

/* Your own tiny utilities */
@layer utilities {
  .text-shadow-sm { text-shadow: 0 1px 1px rgba(0,0,0,0.06); }
  .text-shadow    { text-shadow: 0 2px 2px rgba(0,0,0,0.12); }
  .text-shadow-lg { text-shadow: 0 4px 8px rgba(0,0,0,0.24); }
}
```

**Usage:**
```html
<button class="btn">Save changes</button>
<p class="text-shadow">Shadowed text</p>
```

> Put **design systemy** classes in `@layer components`; tiny single-purpose rules go in `@layer utilities`.

---

## 5) Dark Mode & Theming Strategies

Tailwindâ€™s dark mode can be `"media"` (prefers-color-scheme) or `"class"`. `"class"` gives you full control.

```js
// tailwind.config.js
module.exports = {
  darkMode: "class",
  // ...
}
```

**HTML strategy (class toggling):**
```html
<html class="dark">
  <!-- ... -->
</html>
```

**Token-driven theming with CSS variables:**
```css
/* base tokens */
@layer base {
  :root {
    --color-bg: 255 255 255; /* RGB */
    --color-fg: 17 24 39;
    --color-accent: 60 102 255; /* brand-500 */
  }
  .dark {
    --color-bg: 17 24 39;
    --color-fg: 243 244 246;
    --color-accent: 99 102 241; /* indigo-500 */
  }
}

/* consume tokens via Tailwind */
@layer utilities {
  .bg-surface   { background-color: rgb(var(--color-bg)); }
  .text-surface { color: rgb(var(--color-fg)); }
  .accent       { color: rgb(var(--color-accent)); }
  .btn-accent   {@apply px-4 py-2 rounded-lg text-white; background-color: rgb(var(--color-accent));}
}
```

**Usage:**
```html
<body class="bg-surface text-surface">
  <button class="btn-accent">Accent</button>
</body>
```

---

## 6) Arbitrary Values, Variants, and Container Queries

**Arbitrary values** unlock one-off precision:
```html
<div class="w-[37rem] bg-brand-500/10 rounded-[22px]"></div>
```

**Arbitrary variants**: apply utilities under custom conditions.
```html
<!-- group focus within -->
<div class="group/field">
  <input class="border rounded p-2 group-focus-within/field:border-brand-500" />
</div>
```

**Container queries** (Tailwind v3.3+):
```html
<!-- opt-in container -->
<section class="container mx-auto p-6 [container-type:inline-size] [container-name:card]">
  <div class="@lg/card:grid @lg/card:grid-cols-2 gap-6">
    <div class="h-24 bg-gray-100 rounded"></div>
    <div class="h-24 bg-gray-100 rounded"></div>
  </div>
</section>
```
> `@lg/card:` applies when the **named container** (`card`) is â‰¥ the `lg` breakpoint width.

---

## 7) Plugins: Community & Custom

### 7.1 Add community plugins
```bash
npm i @tailwindcss/typography @tailwindcss/forms @tailwindcss/aspect-ratio
```

```js
// tailwind.config.js
module.exports = {
  // ...
  plugins: [
    require("@tailwindcss/typography"),
    require("@tailwindcss/forms"),
    require("@tailwindcss/aspect-ratio"),
  ],
};
```

**Usage:**
```html
<article class="prose">
  <h1>Docs-quality typography</h1>
  <p>Paragraphs, code, lists, and more.</p>
</article>

<input class="form-input" placeholder="With sensible defaults" />
<div class="aspect-w-16 aspect-h-9"><iframe src="..."></iframe></div>
```

### 7.2 Write a tiny plugin
```js
// plugins/text-balance.js
const plugin = require("tailwindcss/plugin");

module.exports = plugin(function({ addUtilities }) {
  addUtilities({
    ".text-balance": { textWrap: "balance" }, // modern CSS property
  });
});
```

```js
// tailwind.config.js
module.exports = {
  // ...
  plugins: [require("./plugins/text-balance.js")],
};
```

---

## 8) Build-Time Controls: Purge/Safelist, Prefix, Important, Core Plugins

### 8.1 Content scanning & safelist
```js
module.exports = {
  content: ["./public/**/*.html", "./src/**/*.{js,ts,jsx,tsx}"],
  safelist: [
    // keep these even if not discovered
    "bg-brand-500", "text-brand-700",
    { pattern: /grid-cols-(1|2|3|4|5|6|12)/ },
  ],
};
```

### 8.2 Prefix classes
```js
module.exports = {
  prefix: "tw-",
};
```
Usage: `tw-flex tw-items-center`

### 8.3 Make utilities `!important`
```js
module.exports = {
  important: true, // or: important: "#app"
};
```

### 8.4 Disable core plugins you donâ€™t use
```js
module.exports = {
  corePlugins: {
    container: false,
    float: false,
  },
};
```

---

## 9) Performance & Production Hardening

- **Tree-shaking:** Ensure `content` paths exactly match your templates to maximize purging.
- **Minification:** Tailwind CLI outputs minified CSS in production builds by default.
- **Design tokens-first:** Prefer config tokens over arbitrary values where repeatable.
- **Bundle size checks:** Inspect final CSS footprint (`npx tailwindcss -o build.css --minify`).
- **Layer hygiene:** Prefer `@layer components` for app patterns to reduce class sprawl.

---

## 10) Worked Example

**Config:** `tailwind.config.js`
```js
/** @type {import('tailwindcss').Config} */
module.exports = {
  darkMode: "class",
  content: ["./public/**/*.html"],
  theme: {
    extend: {
      colors: {
        brand: { 500: "#3c66ff", 600: "#284be0", 300: "#9eb8ff" },
      },
      fontFamily: {
        display: ['"Inter var"', "Inter", "ui-sans-serif", "system-ui"],
      },
    },
  },
  plugins: [require("@tailwindcss/typography")],
};
```

**CSS:** `src/input.css`
```css
@tailwind base;
@tailwind components;
@tailwind utilities;

@layer components {
  .btn-primary {
    @apply inline-flex items-center gap-2 rounded-lg px-4 py-2 font-medium
           bg-brand-500 text-white hover:bg-brand-600
           focus:outline-none focus:ring-2 focus:ring-brand-300;
  }
}
```

**HTML (snippet):**
```html
<html class="dark">
  <head>
    <link href="/public/tailwind.css" rel="stylesheet" />
  </head>
  <body class="bg-surface text-surface font-display">
    <main class="max-w-4xl mx-auto p-6 space-y-6">
      <h1 class="text-3xl md:text-5xl">Advanced Customization</h1>
      <button class="btn-primary">Save</button>
      <article class="prose">
        <h2>Typography plugin demo</h2>
        <p>This paragraph is automatically typeset.</p>
      </article>
    </main>
  </body>
</html>
```

---

## 11) Troubleshooting

- **Classes missing in production?** Check `content` globs and add a `safelist`.
- **Conflicts with third-party CSS?** Use `prefix: "tw-"` or `important: "#app"`.
- **Dark mode not switching?** Ensure `darkMode: "class"` and toggle the `dark` class on `html` or a wrapper.
- **Custom utilities not emitted?** Put them in `@layer utilities` or `@layer components`, not outside.

---

## 12) Quick Checklist

- [ ] Tokens extended in `theme.extend`
- [ ] Plugins installed and registered
- [ ] Dark mode strategy chosen (`media` vs `class`)
- [ ] Useful `@layer` abstractions (`components`, `utilities`)
- [ ] `content` globs accurate + `safelist` where needed
- [ ] (Optional) `prefix`, `important`, `corePlugins` tuning

---

### Next: 10. Real-World Patterns & Component Recipes

Youâ€™re ready to ship a cohesive design system with Tailwind. ðŸš€